---
title: "Classification of Acute Respiratory Distress Syndrome"
author: "Robert Edwards"
output:
  
  pdf_document:
    
    latex_engine: pdflatex
    number_sections: no
    fig_caption: yes
  word_document: default
  html_document:
    
    code_folding: hide
    df_print: paged
    fig_caption: yes
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
header-includes: 
  \usepackage[bottom]{footmisc}
  \usepackage{float}
  \floatplacement{figure}{H}
  \usepackage{color}
  \usepackage{xcolor}
---

```{r setup, include=FALSE, echo = FALSE, eval = TRUE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, comment = NA)
options()
```

```{r libraries, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
library(ggplot2)
library(dplyr)
library(moderndive)
library(skimr)
library(tidyr)
library(kableExtra)
library(gridExtra)
library(xtable)
library(knitr)
library(GGally)
library(broom)
library(purrr)
library(naniar) # missing data eda
library(VIM) # data imputation
```


```{r import_data, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
data.raw.df <- read.csv(file = "../data/ARDSdata_reorder.csv", header = TRUE)
```

```{r rename, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, results="hide"}
# Renaming first feature because it read in wrong
colnames(data.raw.df)[1] <- c("Pt_ID")
```

Removing features that are not relevant to this analysis
```{r reduce, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
Day1_vars <- c("Hospital_Survival", 
#               "Duration_ECMO",
               "Day1ECMO_RR", 
               "Day1ECMO_Vt", 
               "Day1ECMO_FiO2", 
               "Day1ECMO_Ppeak", 
               "Day1ECMO_Pmean", 
               "Day1ECMO_PEEP", 
               "Day1ECMO_PF", 
               "Day1ECMO_SpO2", 
               "Day1ECMO_PaCO2", 
               "Day1ECMO_pH", 
               "Day1ECMO_BE", 
               "Day1ECMO_Lactate", 
               "Day1ECMO_NAdose", 
               "Day1ECMO_MAP", 
               "Day1ECMO_Creatinine", 
               "Day1ECMO_Urea", 
               "Day1ECMO_CK", 
               "Day1ECMO_Bilirubin", 
               "Day1ECMO_Albumin", 
               "Day1ECMO_CRP", 
               "Day1ECMO_Fibrinogen", 
               "Day1ECMO_Ddimer", 
               "Day1ECMO_ATIII", 
               "Day1ECMO_Leukocytes", 
               "Day1ECMO_Platelets", 
               "Day1ECMO_TNFa", 
               "Day1ECMO_IL6", 
               "Day1ECMO_IL8", 
               "Day1ECMO_siIL2")

data.raw.df <- data.raw.df %>%
  select(-Day1_vars)
```


Selecting only rows with data. 
```{r slice, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, results="hide"}
# Select the first 450 rows.  The others are blank
data.raw.df <- data.raw.df %>%
  slice(1:450) 
```


```{r factor, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, results="hide"}
# Make categorical variables factors
data.raw.df <- data.raw.df %>%
  mutate(Indication = factor(Indication)) %>% 
  mutate(ECMO_Survival = factor(ECMO_Survival)) %>%
  mutate(Gender = factor(Gender)) %>%
  suppressMessages()  # suppress output
```

```{r missing_data_PDF, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
pdf(file="../viva/images/missing_data_visualization.pdf", height=8, width=10)
vis_miss(data.raw.df, sort_miss = TRUE)  +
  theme(  plot.margin = ggplot2::margin(0.125, 2, 0.5, 1, "cm") ) #top, right, bottom, left
dev.off()
```


```{r missing_data, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
vis_miss(data.raw.df, sort_miss = TRUE) +
  theme(  plot.margin = ggplot2::margin(0.125, 2, 0.5, 1, "cm") ) #top, right, bottom, left
```

We see that `PreECMO_Albumin` is missing in 46% of observations.  In listwise deletion, this will cause it to drop the entire row if a single observation has missing data.  So we drop this feature.   
```{r drop PreECMO_Albumin, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, results="hide"}
pdf(file="../viva/images/missing_data_visualization_var_dropped.pdf", height=8, width=10)

data.df <- data.raw.df %>% 
  select(-"PreECMO_Albumin")
vis_miss(data.df, sort_miss = TRUE) +
  theme(  plot.margin = margin(0.125, 2, 0.5, 1, "cm") ) #top, right, bottom, left

dev.off()
```

```{r drop PreECMO_Albumin_PDF, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, results="hide"}
data.df <- data.raw.df %>% 
  select(-"PreECMO_Albumin")
vis_miss(data.df, sort_miss = TRUE) +
  theme(  plot.margin = margin(0.125, 2, 0.5, 1, "cm") ) #top, right, bottom, left
```

An upset plot from the `UpSetR` package can be used to visualise the patterns of missingness, or rather the combinations of missingness across cases. To see combinations of missingness and intersections of missingness amongst variables, use the `gg_miss_upset` function:

```{r missing_data_patterns, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
gg_miss_upset(data.df)
```

If there are 40 intersections, there will be up to 40 combinations of variables explored. The number of sets and intersections can be changed by passing arguments `nsets = 10` to look at 10 sets of variables, and nintersects = 50 to look at 50 intersections.

```{r num_missing, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
#n_var_miss(data.df)
gg_miss_upset(data.df, nsets = n_var_miss(data.df)/3)
```

This plot shows the number of missing values in each variable in a dataset. It is powered by the `miss_var_summary()` function.  
```{r var_missing, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
gg_miss_var(data.df, show_pct = TRUE) +
  labs("% Data Missing in Biomarker Data")
```

This plot shows the number of missings in each column, broken down by a categorical variable from the dataset. It is powered by a `dplyr::group_by` statement followed by `miss_var_summary()`.

```{r missing_fct, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
gg_miss_fct(x = data.df, fct = ECMO_Survival) + 
  labs("NAs in Biomarkers by ECMO_Survival")
```

This plot shows the cumulative sum of missing values, reading the rows of the dataset from the top to bottom. It is powered by the `miss_case_cumsum()` function.

```{r cum_missing, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
gg_miss_case_cumsum(data.df)
```


This plot shows the cumulative sum of missing values, reading columns from the left to the right of your dataframe. It is powered by the `miss_var_cumsum()` function.

```{r cum_var_missing, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
gg_miss_var_cumsum(data.df)
```



#Exploratory Data Analysis
We first visually explore the data to get a sense of the features and distributions of the data.  Then we will conduct hypothesis tests for each feature based on `ECMO_Survival` as a rough idea how relevant each feature will be.  


To get an idea of the distribution of the data, the following summary statistics were obtained for the categorical variable `ECMO_Survival` (Table \ref{tab:sum1}) and for the continuous variables (Table \ref{tab:sum2}).

```{r summary1, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, fig.align="center", fig.pos="H"}
data.df <- data.raw.df
data.df %>%
  group_by(ECMO_Survival) %>%
  summarise(n(), round(100*n()/nrow(data.df), 2)) %>%
  kable(col.names = c("ECMO_Survival", "n", "Percent %"),
        caption = '\\label{tab:sum1} Numbers of survivors and nonsurvivors of ECMO treatment.', booktabs = TRUE, format = "latex") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
```

Table \ref{tab:sum1} shows that out of the `r nrow(data.df)` individuals, only `r round(100*sum(data.df$ECMO_Survival=="Y")/nrow(data.df), 2)`% of the individuals in the study sample survived ECMO treatment (`r sum(data.df$ECMO_Survival=="Y")` survived vs `r sum(data.df$ECMO_Survival=="N")` did not survive).  


```{r summary2, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, fig.align="center", fig.pos="H"}
data.df %>%
  group_by(Gender) %>%
  summarise(n(), round(100*n()/nrow(data.df), 2)) %>%
  kable(col.names = c("Gender", "n", "Percent %"),
        caption = '\\label{tab:sum2} Number of males and females.', booktabs = TRUE, format = "latex") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
```

Table \ref{tab:sum2} shows that out of the `r nrow(data.df)` individuals, only `r round(100*sum(data.df$Gender == "m")/nrow(data.df), 2)`% of the individuals in the study sample are male (`r sum(data.df$Gender == "m")` male vs `r sum(data.df$Gender == "w")` female).  

```{r summary3, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, fig.align="center", fig.pos="H"}
data.df %>%
  group_by(Indication) %>%
  summarise(n(), round(100*n()/nrow(data.df), 2)) %>%
  kable(col.names = c("Indication", "n", "Percent %"),
        caption = '\\label{tab:sum3} Number of each disease type indication.', booktabs = TRUE, format = "latex") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
```

Table \ref{tab:sum3} shows the distribution of each disease type indication:

+ ALF - Acute Lung Failure - `r round( sum(data.df$Indication == "ALF")/nrow(data.df)*100, 2 )`%
+ 1 - Viral Pneumonia - `r round( sum(data.df$Indication == 1)/nrow(data.df)*100, 2 )`%
+ 2 - Bacterial Pneumonia - `r round( sum(data.df$Indication == 2)/nrow(data.df)*100, 2 )`%
+ 3 - Aspiration Pneumonitis - `r round( sum(data.df$Indication == 3)/nrow(data.df)*100, 2 )`%
+ 4 - ARDS Trauma - `r round( sum(data.df$Indication == 4)/nrow(data.df)*100, 2 )`%
+ 5 - ARDS Surgery - `r round( sum(data.df$Indication == 5)/nrow(data.df)*100, 2 )`%
+ 6 - Chemo - `r round( sum(data.df$Indication == 6)/nrow(data.df)*100, 2 )`%
+ 7 - Other - `r round( sum(data.df$Indication == 7)/nrow(data.df)*100, 2 )`%


```{r summary4, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, fig.align="center", fig.pos="H"}

for (i in 4:ncol(data.df)) {
  data.df[,i] <- as.numeric(data.df[,i])
}

skim_with(numeric = list(hist = NULL, missing = NULL, complete = NULL))
data.df %>%
  skim_to_list() %>%
  .$numeric %>%
  kable(col.names = c("Variable", "n", "Mean", "SD", "Min", "1st quartile", "Median", "3rd quartile", "Max"),
        caption = '\\label{tab:sum4} Summary statistics on ARDS data continuous variables.', booktabs = TRUE, format = "latex") %>%
  kable_styling(font_size = 10, latex_options = "hold_position")
```

Looking at Table \ref{tab:sum4}






##Violin Plot

All continuous features are normally scaled to be comparable. 
```{r scale, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
feature_names <- colnames(data.df[,5:ncol(data.df)])
data_standard.df <- data.df %>%
  select(5:ncol(data.df)) %>%
  mutate_each_(funs(scale), vars=feature_names)
```

```{r boxplot, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:cor}Boxplot of contnuous variables."}
data_standard.df %>% 
  gather(key = Feature, value = Value) %>% 
  ggplot(aes(x = Feature, y = Value, fill = Feature)) +
    geom_boxplot() +
    xlab("Features") + 
    ylab("Average") + 
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5),
          legend.position="none",
          axis.text.x = element_text(angle = 60, hjust = 1)) 
```

The boxplot shows many highly skewed variables indicating that these likely need to be transformed in some fashion (likely log transformation).  For **logistic regression**, first a model will be fit without transformations and then the not significant variables will be transformed and model fit will be evaluated.  


```{r violinplot, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:violin}Violin plot of continuous variables."}
data_standard.df %>% 
  gather(key = Feature, value = Value) %>% 
  ggplot(aes(x = Feature, y = Value, fill = Feature)) +
    geom_violin(scale = "width", 
                draw_quantiles = TRUE,
                trim = TRUE,
                show.legend = FALSE) +
    geom_boxplot(width = 0.2,
                 outlier.size = 0.5) +
    xlab("Features") + 
    ylab("Scaled Value") +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5),
          legend.position = "none",
          axis.text.x = element_text(angle = 60, hjust = 1))  
```

```{r violinplot, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:violin}Violin plot of continuous variables."}
pdf(file="../viva/images/violinplot.png", height=8, width=10)


data_standard.df %>% 
  gather(key = Feature, value = Value) %>% 
  ggplot(aes(x = Feature, y = Value, fill = Feature)) +
    geom_violin(scale = "width", 
                draw_quantiles = TRUE,
                trim = TRUE,
                show.legend = FALSE) +
    geom_boxplot(width = 0.2,
                 outlier.size = 0.5) +
    xlab("Features") + 
    ylab("Scaled Value") +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5),
          legend.position = "none",
          axis.text.x = element_text(angle = 60, hjust = 1))  

dev.off()
```


##Correlation Plot

```{r heatmap, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:cor}Correlation heatmap of contnuous variables."}
# Correlation matrix plot
ggcorr(data_standard.df[, 1:ncol(data_standard.df)], 
       hjust = 0.95, 
       size = 2, 
       label = TRUE, 
       label_size = 2, 
       label_alpha = TRUE, 
       layout.exp = 5, 
       legend.position = "bottom", 
       legend.size = 8) +
  guides(fill = guide_colorbar(barwidth = 10, 
                               barheight = 0.5, 
                               title.vjust = 0.75)) 
#  theme(  plot.margin = margin(1, 1, 1, 1, "cm") ) #top, right, bottom, left
```

```{r heatmap_PDF, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:cor}Pairs plot of contnuous variables."}
pdf(file="../viva/images/heatmap.pdf", height=8, width=10)

# Correlation matrix plot
ggcorr(data_standard.df[, 1:ncol(data_standard.df)], 
       hjust = 0.95, 
       size = 2, 
       label = TRUE, 
       label_size = 2, 
       label_alpha = TRUE, 
       layout.exp = 2, 
       legend.position = "bottom", 
       legend.size = 8) +
  guides(fill = guide_colorbar(barwidth = 10, 
                               barheight = 0.5, 
                               title.vjust = 0.75)) 
#  theme(  plot.margin = margin(1, 1, 1, 1, "cm") ) #top, right, bottom, left

dev.off()
```


##Pairs Plot

```{r pairsplot1, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:pairs}Pairs plot of continuous variables."}
pairs.df <- cbind(data.df$ECMO_Survival, data_standard.df)
colnames(pairs.df)[1] <- "ECMO_Survival"
pairs.df <- pairs.df %>% 
  select(-PreECMO_Albumin) %>% # Drop variable missing >40% data
  drop_na()  # Drop rows missing data

ggpairs(
  pairs.df,
  mapping = ggplot2::aes(color = ECMO_Survival),
  upper = list(continuous = wrap("density", alpha = 0.5), combo = "box"),
  lower = list(continuous = wrap("points", alpha = 0.4), combo = wrap("dot", alpha = 0.4)),
  diag = list(continuous = wrap("densityDiag"))
  ) 

```


```{r pairsplot2, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H", fig.cap = "\\label{fig:pairs}Pairs plot of continuous variables."}
pdf(file="../viva/images/pairsplot.pdf", height=8, width=10)

pairs.df <- cbind(data.df$ECMO_Survival, data_standard.df)
colnames(pairs.df)[1] <- "ECMO_Survival"
pairs.df <- pairs.df %>% 
  select(-PreECMO_Albumin) %>% # Drop variable missing >40% data
  drop_na()  # Drop rows missing data

group <- NA
group[pairs.df$ECMO_Survival == "Y"] <- 1
group[pairs.df$ECMO_Survival == "N"] <- 2

pairs(pairs.df[, 5:ncol(pairs.df)],
      col = c("red", "blue")[group],   # Change color by group
      cex = 0.125,
      pch = c(20, 20)[group],                            # Change points by group
      labels = names(pairs.df[5:ncol(pairs.df)]),
      alpha = 0.25,
      cex.labels = 0.2,
      main = "Pairs plot grouped by ECMO_Survival")

dev.off()
```




\newpage
#Hypothesis Testing

From the boxplot we see many variables are not normally distributed, or at the least highly skewed.  To run a hypothesis test we should take note that a t-test assumes the data is normally distributed.  For the skewed or non-normal variables we should use an appropriate hypothesis test such as Wilcoxon test that tests for differences in the medians of two samples.  

## Student's t-Tests

```{r summary5, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
t_tests <- map(
  select(data.df, -Pt_ID, -ECMO_Survival, -Gender, -Indication),
  ~ t.test(.x ~ ECMO_Survival, data = data.df)
)

w_tests <- map(
  select(data.df, -ECMO_Survival, -Gender, -Indication),
  ~ wilcox.test(.x ~ ECMO_Survival, data = data.df)
)

hyp_tests <- data.frame(matrix(vector(), 0, 6,
                dimnames=list(c(), c("Variable", "Test", "df", "p.value", "Lower", "Upper"))),
                stringsAsFactors=F)
for (i in 1:length(t_tests)) {
  hyp_tests[i,1] <- names(t_tests[i])
  hyp_tests[i,2] <- t_tests[[1]]$method
  hyp_tests[i,3] <- round(t_tests[[i]]$parameter, 3) # df
  hyp_tests[i,4] <- round(t_tests[[i]]$conf.int[1], 3) # lower
  hyp_tests[i,5] <- round(t_tests[[i]]$conf.int[2], 3) # upper
  hyp_tests[i,6] <- round(t_tests[[i]]$p.value, 3) # p-value
}
```

```{r t-tests, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
hyp_tests %>%
  kable(col.names = c("Variable", "Test", "df", "p.value", "Lower", "Upper"), 
        caption = '\\label{tab:sum5} Hypothesis tests for variables.',
        booktabs = TRUE, 
        format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")
```


\newpage
##Wilcoxon Signed-Rank Tests
```{r summary6, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
w_tests <- map(
  select(data.df, -Pt_ID, -ECMO_Survival, -Gender, -Indication),
  ~ wilcox.test(.x ~ ECMO_Survival, data = data.df)
)

hyp_tests <- data.frame(matrix(vector(), 0, 3,
                dimnames=list(c(), c("Variable", "Test", "p.value"))),
                stringsAsFactors=F)
for (i in 1:length(w_tests)) {
  hyp_tests[i,1] <- names(w_tests[i])
  hyp_tests[i,2] <- w_tests[[i]]$method
  hyp_tests[i,3] <- round(w_tests[[i]]$p.value, 3) # p-value
}
```

```{r wilcoxon, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
hyp_tests %>%
  kable(col.names = c("Variable", "Test", "p.value"), 
        caption = '\\label{tab:sum6} Hypothesis tests for variables.',
        booktabs = TRUE, 
        format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")
```


\newpage
##$\chi^2$ Tests

Need to convert `chars` to numeric factors in the categorical variables
```{r factoring, echo = FALSE, eval = FALSE, warning = FALSE, message = FALSE}
## Converting categorical variables to factors
data.df <- data.df %>% 
  mutate( Gender = ifelse( Gender == "m", 1, 0 )) %>% 
  mutate( ECMO_Survival = ifelse( ECMO_Survival == "Y", 1, 0 ))
```


Two random variables x and y are called independent if the probability distribution of one variable is not affected by the presence of another.

Assume $f_{ij}$ is the observed frequency count of events belonging to both $i$-th category of $x$ and $j$-th category of $y$. Also assume $e_{ij}$ to be the corresponding expected count if $x$ and $y$ are independent. The null hypothesis of the independence assumption is to be rejected if the p-value of the following Chi-squared test statistics is less than a given significance level $\alpha$.

$$
\chi^2 = \sum_{ij} \frac{ (o_{ij} - e_{ij})^2 }{e_{ij}}
$$

###Hypothesis 1
Test the hypothesis whether the `ECMO_Survival` is independent of `Gender` at .05 significance level.

```{r summary7, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H"}
tbl1 = table(data.df$ECMO_Survival, data.df$Gender)
kable(tbl1,
      booktabs = TRUE, 
      format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")

chisq_test1 <- chisq.test(tbl1)
```

###Hypothesis 2
Test the hypothesis whether the `ECMO_Survival` is independent of disease `Indication` at .05 significance level.
```{r summary8, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H"}
tbl2 = table(data.df$ECMO_Survival, data.df$Indication)
kable(tbl2,
      booktabs = TRUE, 
      format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")

chisq_test2 <- chisq.test(tbl2)
```

###Hypothesis 3
Test the hypothesis whether the `Gender` is independent of disease `Indication` at .05 significance level.
```{r summary9, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H"}
tbl3 = table(data.df$Gender, data.df$Indication)
kable(tbl3,
      booktabs = TRUE, 
      format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")

chisq_test3 <- chisq.test(tbl3)
```


```{r summary10, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}

#chi_tests <- map(
#  select(data.df, ECMO_Survival, Gender, Indication),
#  ~ chisq.test(.x ~ ECMO_Survival)
#)

hyp_tests <- data.frame(matrix(vector(), 0, 4,
                dimnames=list(c(), c("Variables", "Test", "df", "p.value"))),
                stringsAsFactors=F)

hyp_tests[1,1] <- "ECMO_Survival / Gender"
hyp_tests[1,2] <- chisq_test1$method # method name
hyp_tests[1,3] <- chisq_test1$parameter # df
hyp_tests[1,4] <- round(chisq_test1$p.value, 3) # p-value

hyp_tests[2,1] <- "ECMO_Survival / Indication"
hyp_tests[2,2] <- chisq_test2$method # method name
hyp_tests[2,3] <- chisq_test2$parameter # df
hyp_tests[2,4] <- round(chisq_test2$p.value, 3) # p-value

hyp_tests[3,1] <- "Gender / Indication"
hyp_tests[3,2] <- chisq_test3$method # method name
hyp_tests[3,3] <- chisq_test3$parameter # df
hyp_tests[3,4] <- round(chisq_test3$p.value, 3) # p-value

```


```{r chi-sqaure, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE, out.width = '100%', fig.align="center", fig.pos="H"}
hyp_tests %>%
  kable(col.names = c("Variables", "Test", "df", "p.value"), 
        caption = '\\label{tab:sum6} Hypothesis tests for variables.',
        booktabs = TRUE, 
        format = "latex") %>%
  kable_styling(font_size = 10, 
                latex_options = "hold_position")
```


```{r save_dataframe}
write.csv(data.df, "../data/ARDS_data_clean.csv",
          row.names=FALSE)
```



















